let log = console.log;

let conv = {
  conversationId:
    '51D|BingProd|E66E85A96960DDAA8FC4F169AF5BF875651B09A412392F46EAADCD271852E70E',
  clientId: '844425739378170',
  conversationSignature: 'MmsU8xstZAhZNrv13V6v9XG20hBzSUEoJEWTmgH3aNc=',
  result: {
    value: 'Success',
    message: null,
  },
};

let mes0 = '{"protocol":"json","version":1}';

let mes1 = '{"type":6}';

let msg2 = `{"arguments":[{"source":"cib","optionsSets":["nlu_direct_response_filter","deepleo","disable_emoji_spoken_text","responsible_ai_policy_235","enablemm","dv3sugg","autosave","iyxapbing","iycapbing","h3imaginative","gencontentv3","uquopt","enpcktrk","udt4upm5gnd","rewards","eredirecturl"],"allowedMessageTypes":["ActionRequest","Chat","Context","InternalSearchQuery","InternalSearchResult","Disengaged","InternalLoaderMessage","Progress","RenderCardRequest","AdsQuery","SemanticSerp","GenerateContentQuery","SearchQuery"],"sliceIds":["scdivetr","tts3","0712newass0","wrapuxslimt2","kcinhero50","kchero50","kcinlineels","kcusenocutimg","mlchatpc8500ns","mlchatpcbase","0731ziv2","707enpcktrks0","812fluxv1pcs0a","0518logoss0","727udtupm","815enftshrclk"],"verbosity":"verbose","scenario":"SERP","plugins":[],"traceId":"64e0942137484c46ab306cd61018a6d9","isStartOfSession":false,"requestId":"0e4d13b7-b9d1-c2db-062c-9f7141c3ad2e","message":{"locale":"en-US","market":"en-US","region":"JP","location":"lat:47.639557;long:-122.128159;re=1000m;","locationHints":[{"country":"Japan","state":"Tokyo","city":"Koto-Ku","zipcode":"162-0843","timezoneoffset":9,"Center":{"Latitude":35.6949,"Longitude":139.7377},"RegionType":2,"SourceType":1}],"userIpAddress":"13.114.30.22","timestamp":"2023-08-19T18:03:38+08:00","author":"user","inputMethod":"Keyboard","text":"how","messageType":"Chat","requestId":"0e4d13b7-b9d1-c2db-062c-9f7141c3ad2e","messageId":"0e4d13b7-b9d1-c2db-062c-9f7141c3ad2e"},"tone":"Creative","conversationSignature":"${conv.clientId}","participant":{"id":"844425739378170"},"spokenTextMode":"None","conversationId":"${conv.conversationId}"}],"invocationId":"1","target":"chat","type":4}`;
let msg2_1 = `{"arguments":[{"source":"cib","optionsSets":["nlu_direct_response_filter","deepleo","disable_emoji_spoken_text","responsible_ai_policy_235","enablemm","dv3sugg","iyxapbing","iycapbing","harmonyv3","saharagenconv5","cgptreasondl","fluxclmodelsp","fluxv1","rai278","replaceurl","enpcktrk","logosv1","udt4upm5gnd","eredirecturl"],"allowedMessageTypes":["ActionRequest","Chat","Context","InternalSearchQuery","InternalSearchResult","Disengaged","InternalLoaderMessage","Progress","RenderCardRequest","AdsQuery","SemanticSerp","GenerateContentQuery","SearchQuery"],"sliceIds":["edi","kcimgov2","0731ziv2","707enpcktrks0","0628ups0","816bof108s0","812fluxv1pcs0a","0518logos","810fluxhi52","727udtupm","815enftshrcs0"],"verbosity":"verbose","scenario":"SERP","plugins":[],"traceId":"64e09b83673945e48552074bc459d80a","isStartOfSession":false,"requestId":"80cdebcd-d92d-ae6d-9180-8c8029ee08f5","message":{"locale":"en-GB","market":"en-GB","region":"JP","location":"lat:47.639557;long:-122.128159;re=1000m;","locationHints":[{"country":"Japan","state":"Tokyo","city":"Koto-Ku","zipcode":"162-0843","timezoneoffset":9,"Center":{"Latitude":35.6949,"Longitude":139.7377},"RegionType":2,"SourceType":1}],"userIpAddress":"13.114.30.22","timestamp":"2023-08-19T18:35:02+08:00","author":"user","inputMethod":"Keyboard","text":"hi","messageType":"Chat","requestId":"80cdebcd-d92d-ae6d-9180-8c8029ee08f5","messageId":"80cdebcd-d92d-ae6d-9180-8c8029ee08f5"},"tone":"Balanced","conversationSignature":"MoF2rd13lmasyw+c2PrT6ZBAg1T5/+9vlUaXAzHyECo=","participant":{"id":"844425739378170"},"spokenTextMode":"None","conversationId":"51D|BingProdUnAuthenticatedUsers|53477B1D4ADF0508E54756199BCF768FE918E6C5E98996F6BC7B23BD434786D4"}],"invocationId":"2","target":"chat","type":4}`;
let msg2_2 = `{"arguments":[{"source":"cib","optionsSets":["nlu_direct_response_filter","deepleo","disable_emoji_spoken_text","responsible_ai_policy_235","enablemm","dv3sugg","iyxapbing","iycapbing","harmonyv3","saharagenconv5","cgptreasondl","fluxclmodelsp","fluxv1","rai278","replaceurl","enpcktrk","logosv1","udt4upm5gnd","eredirecturl"],"allowedMessageTypes":["ActionRequest","Chat","Context","InternalSearchQuery","InternalSearchResult","Disengaged","InternalLoaderMessage","Progress","RenderCardRequest","AdsQuery","SemanticSerp","GenerateContentQuery","SearchQuery"],"sliceIds":["edi","kcimgov2","0731ziv2","707enpcktrks0","0628ups0","816bof108s0","812fluxv1pcs0a","0518logos","810fluxhi52","727udtupm","815enftshrcs0"],"verbosity":"verbose","scenario":"SERP","plugins":[],"traceId":"64e09b83673945e48552074bc459d80a","isStartOfSession":false,"requestId":"369c4183-3a8c-4c81-dd41-d57b022085a7","message":{"locale":"en-GB","market":"en-GB","region":"JP","location":"lat:47.639557;long:-122.128159;re=1000m;","locationHints":[{"country":"Japan","state":"Tokyo","city":"Koto-Ku","zipcode":"162-0843","timezoneoffset":9,"Center":{"Latitude":35.6949,"Longitude":139.7377},"RegionType":2,"SourceType":1}],"userIpAddress":"13.114.30.22","timestamp":"2023-08-19T18:35:02+08:00","author":"user","inputMethod":"Keyboard","text":"hi,what time it now ","messageType":"Chat","requestId":"369c4183-3a8c-4c81-dd41-d57b022085a7","messageId":"369c4183-3a8c-4c81-dd41-d57b022085a7"},"tone":"Balanced","conversationSignature":"MoF2rd13lmasyw+c2PrT6ZBAg1T5/+9vlUaXAzHyECo=","participant":{"id":"844425739378170"},"spokenTextMode":"None","conversationId":"51D|BingProdUnAuthenticatedUsers|53477B1D4ADF0508E54756199BCF768FE918E6C5E98996F6BC7B23BD434786D4"}],"invocationId":"3","target":"chat","type":4}`;

log('create new socket');
let socket = new WebSocket(
  //   'wss://javascript.info/article/websocket/demo/hello'
  'wss://sydney.bing.com/sydney/ChatHub'
);

socket.onopen = function (e) {
  log('[open] Connection established,send msg now');
  socket.send(mes0);
};
socket.onmessage = function (event) {
  log(`[message] Data received from server:`, event.data);
  log(typeof event.data);
  if (event.data == '{}') {
    socket.send(mes1);
    socket.send(msg2_2);
  } else {
    let msgobj = JSON.parse(event.data.slice(0, -1));
    log(msgobj);
  }
};

socket.onclose = function (event) {
  if (event.wasClean) {
    log(
      `[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`
    );
  } else {
    // e.g. server process killed or network down
    // event.code is usually 1006 in this case
    log('[close] Connection died');
  }
};

socket.onerror = function (error) {
  log(`[error]`);
};

// let res=
// {"type":2,"invocationId":"3","item":{"messages":[{"text":"write js code to display a object","author":"user","from":{"id":"844425739378170","name":null,"partnerId":null},"createdAt":"2023-08-19T10:56:14.8302764+00:00","timestamp":"2023-08-19T18:35:02+08:00","locale":"en-GB","market":"en-JP","region":"JP","location":"lat:47.639557;long:-122.128159;re=1000m;","locationInfo":{"country":"Japan","state":"Tokyo","city":"Koto-Ku"},"locationHints":[{"country":"Japan","state":"Tokyo","city":"Koto-Ku","zipCode":"162-0843","timeZoneOffset":9,"sourceType":1,"center":{"latitude":35.6949,"longitude":139.7377,"height":null},"regionType":2}],"userIpAddress":"13.114.30.22","messageId":"369c4183-3a8c-4c81-dd41-d57b022085a7","requestId":"369c4183-3a8c-4c81-dd41-d57b022085a7","nlu":{"scoredClassification":{"classification":"DEEP_LEO","score":null},"classificationRanking":[{"classification":"DEEP_LEO","score":null}],"qualifyingClassifications":null,"ood":null,"metaData":null,"entities":null},"offense":"None","feedback":{"tag":null,"updatedOn":null,"type":"None"},"contentOrigin":"cib","scores":[{"component":"UserOffense","score":3.8528935E-05},{"component":"suicide_help","score":0.009340025}],"inputMethod":"Keyboard"},{"text":"Generating answers for you...","hiddenText":"Generating answers for you...","author":"bot","createdAt":"2023-08-19T10:56:17.4287722+00:00","timestamp":"2023-08-19T10:56:17.4287722+00:00","messageId":"691bce1d-67bf-40cd-a478-12aa1cf230ec","requestId":"369c4183-3a8c-4c81-dd41-d57b022085a7","messageType":"InternalLoaderMessage","offense":"None","adaptiveCards":[{"type":"AdaptiveCard","version":"1.0","body":[{"type":"RichTextBlock","inlines":[{"type":"TextRun","isSubtle":true,"italic":true,"text":"Generating answers for you..."}]}]}],"feedback":{"tag":null,"updatedOn":null,"type":"None"},"contentOrigin":"DeepLeo"},{"text":"Here is a simple JavaScript code to display an object:\n```javascript\nconst myObject = {name: \"John\", age: 30, city: \"New York\"};\nconsole.log(myObject);\n```\nThis code creates an object with three properties: `name`, `age`, and `city`. The `console.log()` function is used to display the object in the console. When you run this code, you will see the object displayed in the console. \n\nI hope this helps! Let me know if you have any other questions. \uD83D\uDE0A","author":"bot","createdAt":"2023-08-19T10:56:17.4289074+00:00","timestamp":"2023-08-19T10:56:17.4289074+00:00","messageId":"08d51309-73ff-4553-bc50-d3d014464faf","requestId":"369c4183-3a8c-4c81-dd41-d57b022085a7","offense":"None","adaptiveCards":[{"type":"AdaptiveCard","version":"1.0","body":[{"type":"TextBlock","text":"Here is a simple JavaScript code to display an object:\n```javascript\nconst myObject = {name: \"John\", age: 30, city: \"New York\"};\nconsole.log(myObject);\n```\nThis code creates an object with three properties: `name`, `age`, and `city`. The `console.log()` function is used to display the object in the console. When you run this code, you will see the object displayed in the console. \n\nI hope this helps! Let me know if you have any other questions. \uD83D\uDE0A\n","wrap":true}]}],"sourceAttributions":[],"feedback":{"tag":null,"updatedOn":null,"type":"None"},"contentOrigin":"DeepLeo","scores":[{"component":"BotOffense","score":0.00045474793},{"component":"BotOffense","score":0.00044421837},{"component":"BotOffense","score":0.00033797944},{"component":"BotOffense","score":0.00034062934}],"suggestedResponses":[{"text":"What is the difference between an object and a variable in JavaScript?","author":"user","createdAt":"2023-08-19T10:56:20.8332553+00:00","timestamp":"2023-08-19T10:56:20.8332553+00:00","messageId":"fb059fad-fd93-420c-b14c-c0c5fe18cbc2","messageType":"Suggestion","offense":"Unknown","feedback":{"tag":null,"updatedOn":null,"type":"None"},"contentOrigin":"SuggestionChipsFalconService"},{"text":"Can you show me how to create an array in JavaScript?","author":"user","createdAt":"2023-08-19T10:56:20.8332563+00:00","timestamp":"2023-08-19T10:56:20.8332563+00:00","messageId":"578f3e25-2bad-4edf-b20d-89bc0fbaab0d","messageType":"Suggestion","offense":"Unknown","feedback":{"tag":null,"updatedOn":null,"type":"None"},"contentOrigin":"SuggestionChipsFalconService"},{"text":"How do I add a property to an existing object in JavaScript?","author":"user","createdAt":"2023-08-19T10:56:20.8332567+00:00","timestamp":"2023-08-19T10:56:20.8332567+00:00","messageId":"0b8d6edc-c730-4e9f-8c05-8cd55150dd81","messageType":"Suggestion","offense":"Unknown","feedback":{"tag":null,"updatedOn":null,"type":"None"},"contentOrigin":"SuggestionChipsFalconService"}]}],"firstNewMessageIndex":1,"defaultChatName":null,"conversationId":"51D|BingProdUnAuthenticatedUsers|53477B1D4ADF0508E54756199BCF768FE918E6C5E98996F6BC7B23BD434786D4","requestId":"369c4183-3a8c-4c81-dd41-d57b022085a7","conversationExpiryTime":"2023-08-19T16:56:20.8624566Z","telemetry":{"startTime":"2023-08-19T10:56:14.8255489Z"},"throttling":{"maxNumUserMessagesInConversation":30,"numUserMessagesInConversation":9,"maxNumLongDocSummaryUserMessagesInConversation":50,"numLongDocSummaryUserMessagesInConversation":0},"result":{"value":"Success","message":"Here is a simple JavaScript code to display an object:\n```javascript\nconst myObject = {name: \"John\", age: 30, city: \"New York\"};\nconsole.log(myObject);\n```\nThis code creates an object with three properties: `name`, `age`, and `city`. The `console.log()` function is used to display the object in the console. When you run this code, you will see the object displayed in the console. \n\nI hope this helps! Let me know if you have any other questions. \uD83D\uDE0A","serviceVersion":"20230818.115"}}}{"type":3,"invocationId":"3"}
